FROM msaraiva/elixir-dev

RUN apk --update add \
    docker erlang-xmerl \
    linux-headers \
    erlang-crypto erlang-syntax-tools && \
    rm -rf /var/cache/apk/*

ENV APP_NAME thing
ENV APP_VERSION "0.1.0"
ENV PORT 4000

COPY . /build

ENV MIX_ENV prod

WORKDIR /build

RUN mix deps.get --only prod
RUN mix compile
RUN echo y | mix release.clean --implode
RUN echo y | mix release

WORKDIR /build

CMD ["/bin/sh"]